\chapter{Следующие Шаги}

React - одна из самых великолепных библиотек из выпущенных в последние годы. И ее мощь заключается даже не в самой библиотеке со всеми ее возможностями, а во всей инфраструктуре, построенной вокруг нее.

Новые проекты и инструменты, которые можно изучить для получения нового опыта, появляются каждый день, что вдохновляет на новые подвиги. Помимо этого организуется множество конференций и встреч, на которых вы можете укрепить ваши знания и познакомиться с новыми людьми. Множество блогов и статей также помогут вам с поиском ответов на различные вопросы. Таким образом, есть неисчерпаемый источник для совершенствования ваших навыков разработчика.

React и экосистема вокруг него поощряют использование лучших практик и любовь к открытому исходному коду, что внушает надежду на светлое будущее нашей профессии.

В этой главе мы рассмотрим следующие вопросы:

\begin{itemize}
  \item Как внести свой вклад в развитие React при помощи создания вопросов (issues) и Запросов на принятие изменений (Pull Requests)
  \item Важность обратной связи и публикации исходного кода для сообщества
  \item Важные аспекты, которые стоит держать в голове при публикации исходного кода
  \item Как публиковать npm пакеты и какой политике наименования версий следовать
\end{itemize}


\section{Вносим вклад в React}

После того, как вы пообвыклись с React, вы можете захотеть внести свой вклад в развитие этой библиотеки. React - библиотека с открытым исходным кодом, что означает, что каждый, кто подписал \textbf{Contributor License Agreement (CLA)} может помогать с исправлением багов, написанием документации или даже добавлением новых возможностей в саму библиотеку.

Вы можете найти сам CLA по следующей ссылке:

\begin{quotation}
	\href{https://code.facebook.com/cla}{https://code.facebook.com/cla}
\end{quotation}

Предположим, что вы попытались собрать приложение при помощи React и обнаружили ошибку; что вы будете делать? Прежде всего стоит создать небольшой и воспроизводимый пример проблемы. Для этого есть удобный шаблон в \textbf{JSFiddle}, созданной командой React:

\begin{quotation}
	\href{https://jsfiddle.net/reactjs/69z2wepo/}{https://jsfiddle.net/reactjs/69z2wepo/}
\end{quotation}

У такого способа есть два плюса:

\begin{itemize}
  \item Вы будете уверены на 100 процентов, что ошибка на стороне библиотеки и не связана с кодом вашего проекта или окружением вашего компьютера
  \item Это помогает команде React быстрее понять проблему, так как разработчикам не придется продираться через код вашего проекта
\end{itemize}

Также Fiddle использует последнюю версию библиотеки. Это избавляет от проблемы того, что вы можете использовать устаревшую версии библиотеки и пытаться сообщить о проблеме, которая уже устранена. Остальные вопросы помогут вам объяснить проблему, а также описать текущее и ожидаемое поведение.

Также перед внесением правок в библиотеку важно ознакомиться с \textit{Facebook Code of Conduct}: \href{https://code.facebook.com/codeofconduct}{https://code.facebook.com/codeofconduct}. Этот документ перечисляет хорошие манеры поведения, которые ожидаются от всех членов сообщества, и которым все должны следовать.

После оформления вопроса (issue) необходимо подождать, пока контрибьюторы проверят его и вынесут решения относительно необходимости внесения правок. В зависимости от критичности проблемы они могут исправить проблему сами или попросить об этом вас.

Во втором случае вы можете создать ответвление (fork) проекта и написать код для решения проблемы. Важно следовать общим правилам оформления кода и создавать тесты, воспроизводящие проблему. Также важно, чтобы старые тесты не начали падать после внесения изменений, так как это будет означать, что вы ломаете уже существующий функционал. 

После того, как проблема исправлена внутри вашего ответвления, а все тесты показывают зеленый свет, вы можете создать \textbf{Запрос на принятие изменений (Pull Request)} (прим.пер. используйте оригинальный термин в реальной жизни, пожалуйста) и ждать, когда основная команда разработчиков рассмотрит его. Они могут решить влить ваши изменения в основной репозиторий или попросить вас поправить его.

Если вы не обнаружили ни одного бага, но все равно хотите внести свой вклад в библиотеку, вы можете посмотреть в список проблем с тегом \textbf{good first bug} на GitHub:

\begin{quotation}
	\href{https://github.com/facebook/react/labels/good\%20first\%20bug}{https://github.com/facebook/react/labels/good first bug}
\end{quotation}

Это отличный способ начать приносить вклад в развитие библиотеки, и это великолепно, что команда React организует удобный способ, с помощью которого каждый получает возможность стать частью проекта.

Если вы нашли интересную проблему (issue), которую еще никто не взял, напишите в комментариях, что готовы взяться за нее. Кто-то из разработчиков должен выйти с вами на связь. Обязательно объясните до написания кода, каким образом вы собираетесь решать проблему, чтобы получить обратную связь и избежать переписывание кода.

Еще можно улучшить React посредством добавления новых возможностей в библиотеку. Важно сказать, что у команды разработки React есть определенный план, которому они следуют.

Если вы хотите узнать, что должно быть добавлено в библиотеку в ближайшее время, вы можете проверить тег \textbf{big picture} на GitHub:

\begin{quotation}
	\href{https://github.com/facebook/react/issues?q=is:open+is:issue+label:\%22big+pict ure\%22}{https://github.com/facebook/react/issues?...}
\end{quotation}

На случай, если у вас есть идеи того, что по вашему мнению должно быть добавлено в библиотеку, прежде всего стоит создать проблему (issue) на GitHub и начать диалог с командой React. Не стоит начинать писать код и делать запросы на внесение изменений до того, как вы поговорите с командой, так как ваша идея может идти в разрез с планами основной команды или конфликтовать с другим функционалом библиотеки.

\section{Распространение вашего кода}

Вклад в экосистему React не ограничивается только добавлением нового кода в репозиторий React. Вернуть долг родине вы также можете путем создания новых пакетов, постов в блогах, ответами на Stack Overflow и множеством других способов.

Предположим, что вы создали React компонент, который решает какую-то проблему, и вы предполагаете, что другим разработчикам будет выгодно воспользоваться вашим решением вместо разработки собственного. Лучше всего будет опубликовать код на GitHub, чтобы каждый мог изучить его и при необходимости воспользоваться. Однако, публикация кода - это только первый шаг, который тем не менее накладывает на вас некоторые обязательства, поэтому стоит понимать, зачем вы это делаете. 

С одной стороны, вы можете публиковать свой код для того, чтобы улучшить навыки разработчика. Публикация кода подталкивает следовать лучшим практикам и писать чистый код. С другой стороны вы можете получить обратную связь от других разработчиков. Это поможет вам получить советы и улучшить код.

Помимо советов относящихся непосредственно к вашему коду, вы можете получить от других людей новые идеи. Даже если вы создали компонент для решения конкретной проблемы, другие разработчики могут использовать его немного в других целях, находя ему новые применения. Помимо этого, кому-то будет не хватать чего-то в этом компоненте, и он может помочь с добавлением новых возможностей, что принесет пользу в том числе и вам. Совместная разработка улучшает и ваши навыки в разработке и разработанные вами пакеты, именно поэтому я верю в открытый код.

Еще одна польза, которую вы получаете от работы над открытым кодом, это сотрудничество с сильными разработчиками со всего мира. Совместная работа с людьми, у которых за спиной отличные от вашего набор навыков и опыт, помогает совершенствовать себя и оставаться открытым к новым идеям.

Публикация кода накладывает на вас определенные обязанности и отнимает ваше время. По факту, после того, как люди начали использовать ваш код, вы вынуждены поддерживать его. 

Поддержка кода требует вашего участия, и чем популярнее становится репозиторий, тем больше вопросов и проблем будет возникать у пользователей. Например, в вашем коде могут обнаружить ошибки; в этом случае вам придется попытаться воспроизвести проблему и при необходимости поправить ее. Также, другие разработчики могут присылать вам объемные запросы на изменения (pull requests), которые вам придется проверять. 

Если вы решите попросить других людей о помощи в поддержке репозитория, вам придется координировать работу между ними, следить за тем, чтобы у всех было общее видение будущего репозитория, а также совместно принимать решения. Держа это в голове, мы можем пройти по некоторым хорошим практикам, которые помогут вам сделать репозиторий лучше и не натолкнуться на типичные подводными камнями.

Прежде всего, если вы хотите опубликовать ваш компонент, вы должны написать для него исчерпывающий набор тестов. Когда код становится публичным, и множество людей вносит в него изменения, тесты становятся очень полезными по следующим причинам:

\begin{itemize}
  \item Они делают код надежнее
  \item Они помогают другим разработчикам понять, что код делает
  \item Они помогают найти поломки старого функционала при добавлении нового
  \item Они добавляют уверенности при написании нового кода
\end{itemize}

Вторая важная вещь - это \textit{README} для вашего компонента с детальным описанием, примерами использования, а также документацией API и параметров (props), которые можно использовать.

Это поможет пользователям пакета разобраться, как надо его использовать, что сократит количество вопросов на GitHub.	

Также может быть полезно добавить файл \textit{LICENSE}, чтобы пользователи знали, что они могут (и что не могут) делать с вашим пакетом. На GitHub есть множество шаблонов для этого файла, так что проблем возникнуть не должно.

Вы должны минимизировать количество внешних зависимостей для вашего пакета настолько, насколько это возможно. Разработчики часто смотрят на размер пакета, когда решают, стоит ли добавлять его в проект. Помните, что раздутые пакеты оказывают не лучшее влияние на производительность.

Еще одна проблема с большим количеством внешних зависимостей в том, что они могут сломать ваш компонент, если в них появляются ошибки или они перестают поддерживаться.

Еще одна неочевидная вещь в публикации React компонентов заключается в добавлении стилей. С публикацией JavaScript кода в общем и целом все просто, но с добавленим CSS все не так просто, как вы можете подумать. Есть множество способов добавления CSS в код: от добавления файла с CSS до использования встроенных стилей. Здесь стоит помнить о том, что CSS глобальны, и использование общих имен может привести к конфликтам.

Лучшим решением будет добавление минимально необходимого набора стилей и возможности легкой кастомизации под нужды конкретного проекта. В этом случае больше людей сможет воспользоваться компонентом, так как его проще будет использовать с уже существующим кодом.

Чтобы показать, что ваш компонент легко настраивается, вы можете добавить несколько примеров его использования в ваш репозиторий. Эти примеры будут также полезны для обнаружения непредсказуемых поломок при обновлении версии.

Как мы уже обсуждали в \textit{Главе 3}, вы можете использовать специальные инструменты, такие как \textbf{React Storybook}, чтобы создавать запускаемые примеры ваших компонентов. Для вас это упростит процесс поддержки, а для ваших пользователей навигацию (если компонентов много) и использование компонентов.

Образцовым примером библиотеки компонентов с удобной кастомизацией и примерами в Storybook может быть \textit{react-dates} от AirBnb. Вы можете использовать репозиторий этой библиотеке в качестве примера публикации React компонентов на GitHub.

И еще один момент: скорее всего вы хотите не только поделиться своим кодом, но и сделать его доступным как пакет (package). Один из самых популярных менеджеров пакетов для JavaScript - \textit{npm}, который мы использовали на протяжении всей книги для подключения внешних зависимостей.

В следующей части мы посмотрим, как опубликовать пакет через \textit{npm}.
 
Также, другим разработчикам может потребоваться установить ваш пакет глобально, чтобы пользоваться им без участия менеджера пакетов.

Как мы видели в первой главе, вы можете легко добавить React на страницу при помощи тега \textit{script} со ссылкой на \textit{unpkg.com}. Важно добавить для вашей библиотеки такую же возможность.

Таким образом, если вы предоставляет возможность глобального использования вашей библиотеки, вам стоит также создать \textbf{Universal Module Definition (UMD)}. Это очень легко сделать при помощи \textbf{Webpack}; вам необходимо добавить атрибут \textit{libraryTarget} в секцию \textit{output} в файле с конфигурацией.

\section{Публикация npm пакета}

Самый популярный способ сделать пакет доступным для разработчиков - опубликовать его в \textit{npm}, менеджере пакетов для Node.js.

Мы использовали \textit{npm} на протяжении всей книги, и вы уже видели множество раз, как легко добавить новый пакет в проект: достаточно лишь выполнить команду \textit{npm install <package>}, и все. Но чего вы не знаете, насколько это легко опубликовать новый пакет.

Прежде всего, если вы откроете пустую директорию и выполните:

\begin{lstlisting}
	npm init
\end{lstlisting}

Вам будут заданы несколько вопросов. Первым будет название пакета (по умолчанию название директории), а затем номер версии. Это самые важные в данном контексте вопросы; именно на имя пакета будут ссылаться пользователи при установке, а смена версий позволит безопасно обновлять код библиотеки, не ломая при этом существующие проекты.

Номер версии состоит из трех чисел, соединенных точкой, и каждое из этих чисел имеет свое значение. Последнее из этих трех чисел отвечает за патч (patch), и должно увеличиваться после внесения изменений с исправлением ошибок.

Среднее число отвечает за минорную (minor) версию библиотеки и должно увеличиваться после добавления новых возможностей, которые не ломают существующее API.

И первой из чисел отвечает за мажорную (major) версию библиотеки и должно увеличиваться после внесения изменений, ломающих обратную совместимость с предыдущими версиями библиотеки.

Следование этому правилу, которое называется \textbf{Semantic Versioning (SemVer)}, является хорошей практикой и помогает пользователям увереннее обновлять библиотеку.

Первая версия библиотеки обычно \textit{0.1.0}. 

Для публикации \textit{npm} пакета вам нужен \textit{npm} аккаунт, который можно легко создать из консоли:

\begin{lstlisting}
	npm adduser $username
\end{lstlisting}

Где \textit{\$username} - имя по вашему выбору.

После этого вы можете запустить:

\begin{lstlisting}
	npm publish
\end{lstlisting}

Новая запись (entry) с именем и версией, которые вы указали в \textit{package.json}, будет добавлена в реестр (registry). 

После того, как вы обновили код и хотите его опубликовать, достаточно выполнить команду:

\begin{lstlisting}
	npm version $type
\end{lstlisting}

Где вместо \textit{\$type} нужно подставить \textit{patch}, \textit{minor} или \textit{major}. Эта команда автоматически обновит версию в \textit{package.json}, а также добавит коммит и тег в системе контроля версий (если таковая подключена).

После этого вам нужно снова выполнить \textit{npm publish}, и пользователям будет доступна новая версия библиотеки.

\section{Заключение}

Это наша заключительная остановка в путешествии по миру React. В данной главе мы посмотрели, что делает React таким великолепным: его сообщество, его экосистему и возможность принести свой вклад в его развитие.

Вы узнали, как заводить Проблему (Issue), если вы нашли ошибку в React, и что делать для облегчения ее исправления. Теперь вы знаете, как сделать ваш код открытым для сообщества, какую пользу вы при этом получаете, и какая ответственность после этого на вас ложится.

И в конце мы посмотрели, как публиковать свои собственные \textit{npm} пакеты, и как правильно указывать версию, чтобы не сломать чужой код, использующий вашу библиотеку.










